# WorldQLDocker
**FOR DEVELOPMENT PURPOSES ONLY**

Docker-based virtualized development and testing tools for WorldQL.

## Cloning the repo
```bash
~/# git clone https://github.com/WorldQL/WorldQLDocker/
~/# cd WorldQLDocker/
```

## Installing the helper tools
You will need the following:
- [Docker](https://docs.docker.com/get-docker/)
- [Kubernetes](https://kubernetes.io/docs/setup/) (Optional)

It is HIGHLY recommended you spend time understanding what these tools are and what they do before trying to use them or trying to work with them.

## To use
__All use cases described below assume you have cloned this repository and are in the root directory for the repository.__

### Standalone control plane
(For use when you want to test servers directly, usually when working with the server plugin).
```bash
WorldQLDocker/# cd Docker 
Docker/# docker build -t worldql:dev-standalone-db-cp standaloneDBControlPlane.dockerfile
Docker/# docker run -dt --network="host" worldql:dev-standalone-db-cp
```

#### Setup a Spigot client server

### Composed Stack
(For use when you want to test full stack deployment with internal networking and/or want tools to inspect the database).
```bash
WorldQLDocker/# docker-compose up -d -f ./docker-compose.yml
```

If you want to run a non-release build, such as in cases where you are testing the plugin in development against a stack environment, place the plugin, named `WorldQLClient.jar` into `Docker/ClientServer` (Full path from the root would be `./Docker/ClientServer/WorldQLClient.jar`).  At this point, you MUST delete the image tagged `worldqldocker_client-minecraft-server:latest`, after which you should run the following (Make sure to STOP the previous stack fully if you deployed it).

```bash
WorldQLDocker/# docker-compose up -d -f ./docker-compose.manual.yml
```

To rebuild the container without having to delete the old image, you may alternatively run the following.  After running this, you MUST start the service independently.
```bash
WorldQLDocker/# docker-compose up -d -f ./docker-compose.manual.yml --no-deps --build client-minecraft-server
```

#### F.A.Q.
- What do I do to reset my world?
  - Destroying and re-deploying the composed environment is the simplest way to create a brand new world with a new seed in the composed system.  If you want to simply reset the world, you may delete the world database data.

### Kubernetes
(For use when you want to run this in a production environment or want to test creating and destroying servers dynamically).
```bash
WorldQLDocker/# kubectl apply -f Kubernetes/ServerScalable/Setup.yaml
```

Generate values for all of the following:
- Postgres db user name
- Postgres db password (cryptographically secure)
- Postgres db database name
- TODO: Add more values here as needed, likely we will want control plane config in secrets

Apply those values to the Kubernetes secrets generated by the setup file.

```bash
##TODO
```

If you do not have a dedicated database deployment, attach the database deployment file and add the service hostname to the database secret
```bash
WorldQLDocker/# kubectl apply -f Kubernetes/ServerScalable/Database.yaml
```

And attach the deployment.
```bash
WorldQLDocker/# kubectl apply -f Kubernetes/ServerScalable/Deploy.yaml
```
